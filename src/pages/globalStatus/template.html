<dci-title title="Global Status"></dci-title>
<div class="container-fluid">
  <div class="row">
    <div class="col-xs-12">
      <dci-loading ng-if="$ctrl.loading"></dci-loading>
      <div ng-hide="$ctrl.loading">
        <div class="row">
          <div class="col-xs-12">
            <div class="global-status__summary">
              <div class="global-status__item text-center"
                   ng-repeat="stat in $ctrl.globalStatus"
                   ng-class="{
                        'global-status__item--success': stat.percentageOfSuccess > 30,
                        'global-status__item--danger': stat.percentageOfSuccess <= 30
                        }">
                <h3>
                  <i class="fa fa-warning" ng-if="stat.percentageOfSuccess === 0"></i>
                  {{stat.topic_name}}
                </h3>
                <p class="global-status__body">
                  <span>
                    {{stat.percentageOfSuccess}}% success
                  </span>
                </p>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-xs-12">
            <div ng-repeat="stat in $ctrl.globalStatus">
              <h2>{{stat.topic_name}} - {{stat.name}}</h2>
              <br>
              <table class="table table-bordered">
                <thead>
                <th>Team</th>
                <th>Remote CI (Configuration)</th>
                <th class="text-center">Status</th>
                <th class="text-right">Last run</th>
                </thead>
                <tbody>
                <tr ng-repeat="job in stat.jobs"
                    ng-class="{'success': job.status === 'success', 'danger': job.status === 'failure'}">
                  <td>{{ job.team_name | uppercase }}</td>
                  <td>
                    {{ job.remoteci_name }}
                    <span ng-if="job.rconfiguration_name">({{ job.rconfiguration_name }})</span>
                  </td>
                  <td class="text-center"><a ui-sref="auth.job.jobStates({id: job.id})">{{ job.status }}</a></td>
                  <td class="text-right">{{job.created_at | dciFromNow}}</td>
                </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
